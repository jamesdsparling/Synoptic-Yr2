<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      body {
        padding: 0;
        margin: 0;
      }
      html,
      body,
      #map {
        height: 100%;
        width: 100%;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
      integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
      crossorigin=""
    />

    <script
      src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
      integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
      crossorigin=""
    ></script>

    <script src="https://unpkg.com/wrld.js@1.x.x"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.1/leaflet.css" rel="stylesheet" />

    <link href="https://cdn-webgl.wrld3d.com/wrldjs/addons/resources/v1/latest/css/wrld.css" rel="stylesheet"/>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.min.js"></script>
    <link href="https://cdn-webgl.wrld3d.com/wrldjs/addons/polygon_editor/latest/polygon_editor.css" rel="stylesheet" />
    <script src="https://cdn-webgl.wrld3d.com/wrldjs/addons/polygon_editor/latest/polygon_editor.js"></script>

    <title>Cape York</title>
  </head>
  <body>
    <a style="color: red" href="/">Map</a>
    <a href="/report">Report</a>
    <a href="/fire">Fire</a>
    <a href="/water">Water</a>
    <a href="/info">Info</a>
    <a href="/contact">Contact</a>
    <a href="/help">Help</a>
    <div id="map"></div>

    <script>

      var center = [-10.689457, 142.531821];
      
      var map = L.map("map").setView(center, 17);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: "Â© OpenStreetMap",
      }).addTo(map);

      L.marker(center).addTo(map);

      var editableLayers = new L.featureGroup();
      map.addLayer(editableLayers);

      const options = {
        draw: {
          polygon: {
            allowIntersection: false,
            allowOverlap: false,
            showArea: true,
            shapeOptions: {
              color: '#3375CC',
              weight: 5
            }
          }
        },
        edit: {
          poly: {
            allowIntersection: false,
            allowOverlap: false
          }
        }
      };

      var polygonEditor = new WrldIndoorPolygonEditor(map, options);

      var counter = 0;

      map.on(L.Draw.Event.CREATED, function (e) {
        var layer = e.layer;
        if (layer instanceof Wrld.Polygon) {
          layer.setUserData(counter++);
          console.log("Created Polygon with userdata: " + layer.getUserData());

          layer.on("click", function(e) {
            console.log("Polygon data: " + e.target.getUserData() + " Points: " + e.target.getLatLngs());
          });
        }
      });
    
      map.on(L.Draw.Event.DELETED, function (e) {
        var layers = e.layers;
        layers.eachLayer(layer => {
          if (layer instanceof Wrld.Polygon) {
            console.log("Deleted Polygon with userdata: " + layer.getUserData());
          }
        })
      });

      var fireIcon = L.icon({
        iconUrl: "fireIcon.png",
        iconSize: [48, 65.48], // size of the icon
      });

      var waterIcon = L.icon({
        iconUrl: "waterIcon.png",
        iconSize: [48, 48], // size of the icon
      });

      var coralIcon = L.icon({
        iconUrl: "coralIcon.png",
        iconSize: [48, 48], // size of the icon
      });

      var circle = L.circle([-10.688521, 142.53125], {
        color: "yellow",
        fillColor: "yellow",
        fillOpacity: 0.5,
        radius: 50,
      });
      circle.addTo(map);

      class polygonWithIcon {
        constructor(polygon, icon, color) {
          this.polygon = L.polygon(polygon, {
            color: color,
            fillColor: color,
            fillOpacity: 0.5,
          });
          this.marker = L.marker(this.polygon.getBounds().getCenter(), {
            icon: icon,
          });
          this.group = L.featureGroup([this.polygon, this.marker]);
        }

        addTo(map) {
          this.group.addTo(map);
        }

        bindPopup(content) {
          this.group.bindPopup(content);
        }
      }

      class firePoly extends polygonWithIcon {
        constructor(polygon) {
          super(polygon, fireIcon, "red");
        }
      }

      class waterPoly extends polygonWithIcon {
        constructor(polygon) {
          super(polygon, waterIcon, "blue");
        }
      }

      class coralPoly extends polygonWithIcon {
        constructor(polygon) {
          super(polygon, coralIcon, "green");
        }
      }

      let fire1Pos = [
        [-10.689277, 142.531764],
        [-10.689966, 142.53268],
        [-10.691178, 142.532419],
        [-10.690155, 142.531786],
      ];
      let fire1 = new firePoly(fire1Pos);
      fire1.bindPopup("<b>Fire!</b><br>Stay away.");
      fire1.addTo(map);

      let water1Pos = [
        [-10.69013, 142.53339],
        [-10.69056, 142.53384],
        [-10.69057, 142.53323],
      ];
      let water1 = new waterPoly(water1Pos);
      water1.bindPopup("Water source");
      water1.addTo(map);

      let coral1Pos = [
        [-10.68893, 142.53081],
        [-10.68956, 142.531],
        [-10.69012, 142.53135],
        [-10.69083, 142.5316],
        [-10.69131, 142.53168],
        [-10.69106, 142.53068],
        [-10.69033, 142.53052],
      ];
      let coral1 = new coralPoly(coral1Pos);
      coral1.bindPopup("Coral");
      coral1.addTo(map);

      let marker1 = L.marker([-10.68778, 142.53159]);
      marker1.bindPopup("Custom marker");
      marker1.addTo(map);


    </script>

    
  </body>
</html>
